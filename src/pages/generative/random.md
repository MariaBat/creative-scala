## Τυχαιότητα χωρίς Επιπτώσεις

```tut:invisible
import doodle.core._
import doodle.core.Image._
import doodle.syntax._
import doodle.jvm.Java2DFrame._
import doodle.backend.StandardInterpreter._
```

Η λύση στο πρόβλημά μας είναι να χωρίσουμε την περιγραφή του τρόπου χρήσης των τυχαίων αριθμών από την διαδικασία της πραγματικής παραγωγής τους. Ακούγεται μπερδεμένο αλλά στην πραγματικότητα κάναμε το ίδιο με τα `Image` σε όλο το βιβλίο.

- περιγράφουμε μία `Image` χρησιμοποιώντας μονοπάτια και μεθόδους όπως οι `beside`, `above`, και `on` και
- ζωγραφίζουμε την `Image` μόνο όταν καλούμε την `draw`.

Το ίδιο ακριβώς κάνουμε και με τον τύπο `Random` του Doodle. Για να έχουμε πρόσβαση σ' αυτόν τον κώδικα πρέπει πρώτα να φορτώσουμε το πακέτο `doodle.random`.

```tut:silent:book
import doodle.random._
```

Τώρα μπορούμε να φτιάξουμε τιμές που περιγράφουν την δημιουργία τυχαίων αριθμών

```tut:book
val randomDouble = Random.double
```

Όμως κανένας τυχαίος αριθμός δεν παράγεται πραγματικά πριν καλέσουμε την μέθοδο `run`.

```tut:book
randomDouble.run
```

Ο τύπος `Random[Double]` μας προϊδεάζει για την παραγωγή ενός `Double` τυχαίου αριθμού για όταν τον τρέξουμε. Ακριβώς όπως και με την `Image` και την `draw`, η αντικατάσταση της `Random` ισχύει μέχρι να την εκτελέσουμε.

Ο πίνακας [@tbl:generative:random] δείχνει μερικούς τρόπους για κατασκευή τυχαίων τιμών.

----------------------------------------------------------------------------------------
Μέθοδος                    Περιγραφή                       Παράδειγμα
-------------------------- ------------------------------ ------------------------------
`Random.always(value)`     Δημιουργεί μία τυχαία τιμή       `Random.always(10)`
                           η οποία πάντα παράγει την
                           δοσμένη τιμή.

`Random.double`            Δημιουργεί μία τυχαία τιμή       `Random.double`
                           η οποία παράγει `Double`
                           ομοιόμορφα κατανεμημένους
                           μεταξύ`0.0` και `1.0`.

`Random.int`               Δημιουργεί μία τυχαία τιμή        `Random.int`
                           η οποία παράγει αριθμούς `Int`
                           ομοιόμορφα κατανεμημένους
                           σε όλο το διάστημα.

`Random.natural(limit)`    Δημιουργεί μία τυχαία τιμή        `Random.natural(10)`
                           η οποία παράγει αριθμούς `Int`
                           ομοιόμορφα κατανεμημένους
                           στο διάστημα που είναι
                           μεγαλύτερο ή ίσο με το `0`
                           και μικρότερο από το`1`.

`Random.oneOf(value, ...)` Δημιουργεί μία τυχαία τιμή        `Random.oneOf("A", "B", "C")`
                           η οποία παράγει μία από τις
                           δοσμένες τιμές με ίση
                           πιθανότητα.
----------------------------------------------------------------------------------------

: Μερικές από τις μεθόδους που δημιουργούν τυχαίες τιμές. {#tbl:generative:random}


### Συντάσσοντας Τυχαίες Τιμές

Τώρα που είδαμε πώς μπορούμε να δημιουργήσουμε μία τυχαία τιμή, πώς τις συντάσσουμε μέσα σε πιο ενδιαφέροντα προγράμματα; Για παράδειγμα, πώς μπορούμε να μετατρέψουμε μία τυχαία `Double` σε τυχαία `Angle`? Ίσως είναι δελεαστική η κλήση της `run` κάθε φορά που θέλουμε να χειριστούμε ένα τυχαίο αποτέλεσμα αλλά αυτό θα απειλούσε την έννοια της αντικατάστασης, κάτι που θέλουμε να αποφύγουμε.

Θυμηθείτε ότι όταν μιλήσαμε για την `map` σε προηγούμενα κεφάλαια είπαμε ότι μπορεί να μετασχηματίσει τα στοιχεία μίας λίστας αλλά κρατάει την δομή της (τον αριθμό των στοιχείων που περιέχει). Η ίδια αναλογία εφαρμόζεται και στην μέθοδο `map` για τυχαίους αριθμούς. Μας επιτρέπει να μετασχηματίσουμε το τυχαίο στοιχείο---την τιμή που παράγει όταν εκτελείται---αλλά δεν μας επιτρέπει να αλλάξουμε την δομή. Σ' αυτή την περίπτωση με την έννοια "δομή" εννοούμε την εισαγωγή περισσότερης τυχαιότητας ή τυχαίας επιλογής.

Μπορούμε να δημιουργήσουμε μία τυχαία τιμή και να εφαρμόσουμε έναν *ντετερμινιστικό* μετασχηματισμό χρησιμοποιώντας την `map` αλλά δεν μπορούμε να δημιουργήσουμε μία τυχαία τιμή και μετά να την χρησιμοποιήσουμε ως είσοδο σε διαδικασία που δημιουργεί κάποια άλλη τυχαία τιμή.

Παρακάτω μπορείτε να δείτε πώς μπορούμε να δημιουργήσουμε μία τυχαία γωνία.

```tut:silent:book
val randomAngle: Random[Angle] =
  Random.double.map(x => x.turns)
```

Όταν τρέξουμε την `RandomAngle` θα παραχθούν τυχαίες γωνίες

```tut:book
randomAngle.run
randomAngle.run
```

### Ασκήσεις {-}

#### Τυχαία Χρώματα {-}

Με δεδομένο την `randomAngle` από παραπάνω, φτιάξτε μία μέθοδο η οποία δέχεται τον κορεσμό και την φωτεινότητα και παράγει ένα τυχαίο χρώμα. Η δήλωση της μεθόδου σας θα πρέπει να έχει την παρακάτω υπογραφή

```tut:silent:book
def randomColor(s: Normalized, l: Normalized): Random[Color] =
  ???
```

<div class="example">
Αυτός είναι ένας ντετερμινιστικός μετασχηματισμός της εξόδου της `randomAngle` και μπορούμε να το φτιάξουμε χρησιμοποιώντας την `map`.

```tut:silent:book
def randomColor(s: Normalized, l: Normalized): Random[Color] =
  randomAngle map (hue => Color.hsl(hue, s, l))
```
</div>

#### Τυχαίοι Κύκλοι {-}

Γράψτε μία μέθοδο που δέχεται την ακτίνα και ένα `Random[Color]` (τυχαίο χρώμα) και παράγει έναν κύκλο με την συγκεκριμένη ακτίνα που είναι γεμισμένος με το τυχαίο χρώμα. Η δήλωση της μεθόδου θα πρέπει να έχει την παρακάτω υπογραφή

```tut:silent:book
def randomCircle(r: Double, color: Random[Color]): Random[Image] =
  ???
```

<div class="example">
Για άλλη μία φορά, είναι ένας ντετερμινιστικός μετασχηματισμός τυχαίου χρώματος και άρα μπορούμε να χρησιμοποιήσουμε την `map`.

```tut:silent:book
def randomCircle(r: Double, color: Random[Color]): Random[Image] =
  color map (fill => Image.circle(r) fillColor fill)
```
</div>

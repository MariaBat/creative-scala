## Σειρά Αξιολόγησης

```tut:invisible
import doodle.core._
import doodle.core.Image._
import doodle.syntax._
import doodle.jvm.Java2DFrame._
import doodle.backend.StandardInterpreter._
```

Τώρα είμαστε έτοιμοι να απαντήσουμε στην ερώτηση για την σειρά αξιολόγησης.
Μπορεί να αναρωτιόμαστε αν όντως έχει σημασία;
Στα παραδείγματα που έχουμε δει μέχρι τώρα, η σειρά δεν φαίνεται να έχει σημασία, εκτός από την περίπτωση στην οποία δεν μπορούσαμε να αξιολογήσουμε μια έκφραση πριν αξιολογήσουμε τις υπό-εκφράσεις της.

Για να εξερευνήσουμε αυτά τα θέματα περισσότερο θα πρέπει να εισάγουμε μια νέα έννοια.
Μέχρι εδώ έχουμε ασχοληθεί μόνο με *καθαρές (pure)* εκφράσεις.
Τέτοιες ήταν οι εκφράσεις τις οποίες μπορούσαμε να αντικαταστήσουμε με οποιαδήποτε σειρά [^ειδικές-περιπτώσεις].

Οι *μη-καθαρές (impure)* εκφράσεις είναι αυτές για τις οποίες η σειρά αξιολόγησης μετράει.
Έχουμε ήδη χρησιμοποιήσει μια τέτοια έκφραση, την μέθοδο `draw`.
Αν αξιολογήσουμε τo

```scala
Image.circle(100).draw
Image.rectangle(100, 50).draw
```

και τo

```scala
Image.rectangle(100, 50).draw
Image.circle(100).draw
```

τα παράθυρα που περιέχουν τις εικόνες θα εμφανιστούν σε διαφορετικές σειρές.
Δεν είναι σπουδαία, αλλά *είναι* μια διαφορά, που αυτή είναι η ουσία.

Το κλειδί για να ξεχωρίζουμε τις μη-καθαρές εκφράσεις είναι ότι η αξιολόγησή τους προκαλεί κάποια αλλαγή που μπορούμε να δούμε.
Για παράδειγμα, η αξιολόγηση της `draw` προκαλεί την εμφάνιση μιας εικόνας.
Αυτές τις εύκολα ορατές αλλαγές τις ονομάζουμε *side effects (παρενέργειες)*, ή απλώς *effects* εν συντομία.
Σε ένα πρόγραμμα το οποίο περιέχει side effects δεν μπορούμε να κάνουμε αντικαταστάσεις ελεύθερα.
Όμως μπορούμε να χρησιμοποιήσουμε τα side effects ώστε να ερευνήσουμε την σειρά αξιολόγησης.
Το εργαλείο που θα χρησιμοποιούμε σ'αυτή την περίπτωση θα είναι η μέθοδος `println`.

Η μέθοδος `println` εμφανίζει (??εκτυπώνει??) κείμενο στην κονσόλα (ένα side effect) και αξιολογείται ως μονάδα.
Δείτε ένα παράδειγμα:

```tut:book
println("Hello!")
```

Το side-effect του `println`---εκτύπωση---μας δίνει έναν βολικό τρόπο για να ερευνήσουμε την σειρά αξιολόγησης.
Για παράδειγμα, το αποτέλεσμα της εκτέλεσης του παρακάτω κώδικα

```tut:book
println("A")
println("B")
println("C")
```

υποδεικνύει ότι οι εκφράσεις αξιολογούνται από πάνω προς τα κάτω.
Ας χρησιμοποιήσουμε το `println` ώστε να εξερευνήσουμε λίγο παραπάνω.


### Ασκήσεις {-}

#### Όχι Αντικατάσταση για το Println (??) {-}

Σε ένα καθαρό πρόγραμμα, μπορούμε να δώσουμε όνομα σε οποιαδήποτε έκφραση και να αντικαταστήσουμε τις επόμενες χρήσεις αυτής της έκφρασης με το όνομα.
Συνεπώς, μπορούμε να ξαναγράψουμε το

```tut:silent:book
(2 + 2) + (2 + 2)
```

ως

```tut:silent:book
val a = (2 + 2)
a + a
```

και το αποτέλεσμα του προγράμματος δεν αλλάζει.

Η χρήση της `println` ως παράδειγμα μη-καθαρής έκφρασης, δείχνει ότι *δεν* ισχύει το ίδιο και για τις μη-καθαρές εκφράσεις, και άρα μπορούμε να πούμε ότι οι μη-καθαρές εκφράσεις ή τα side effects, διακόπτουν την διαδικασία αντικατάστασης.

<div class="solution">
Παρακάτω μπορείτε να δείτε ένα απλό παράδειγμα που παρουσιάζει ακριβώς αυτό.
Τα δύο επόμενα προγράμματα είναι εμφανώς διαφορετικά.

```tut:book
println("Happy birthday to you!")
println("Happy birthday to you!")
println("Happy birthday to you!")
```

```tut:book
val a = println("Happy birthday to you!")
a
a 
a
```

Άρα δεν μπορούμε να χρησιμοποιήσουμε την μέθοδο της αντικατάστασης ελεύθερα με την παρουσία των side effects, και πρέπει να σκεφτούμε την σειρά αξιολόγησης.
</div>


#### Τρέλα στις Μεθόδους μας {-}

Όταν μιλήσαμε πρώτη φορά για τις εμβέλειες, μιλήσαμε και για φραγμένες εκφράσεις (block expressions), που όμως δεν τις ονομάσαμε έτσι τότε.
Ένα block δημιουργείται από αγκύλες (`{}`) και αξιολογεί όλες τις εκφράσεις μέσα σε αυτές, με το τελικό αποτέλεσμα να είναι το αποτέλεσμα της τελευταίας έκφρασης του block.

```tut:book
// Αξιολογείται ως 3
{
  val one = 1
  val two = 2
  one + two
}
```

Μπορούμε να χρησιμοποιήσουμε τις φραγμένες εκφράσεις ώστε να εξερευνήσουμε την σειρά με την οποία αξιολογούνται οι παράμετροι μεθόδων, βάζοντας την έκφραση `println` μέσα σε ένα block το οποίο αξιολογείται σε κάποια άλλη χρήσιμη τιμή.

Η χρήση, για παράδειγμα του `Image.rectangle` ή του `Color.hsl` και οι φραγμένες εκφράσεις, καθορίζουν το αν η Scala θα αξιολογήσει τις παραμέτρους της μεθόδου σε μια συγκεκριμένη σειρά , και αν όντως γίνει έτσι, ποια θα είναι αυτή η σειρά.

Σημειώστε ότι μπορείτε να γράψετε ένα block πιο συμπυκνωμένα σε μια γραμμή χωρίζοντας τις εκφράσεις με ερωτηματικά (`;`).
Γενικά, αυτός δεν είναι ωραίος τρόπος αλλά μπορεί να φανεί χρήσιμος γι'αυτά τα παραδείγματα.
Δείτε ένα παράδειγμα.

```tut:book
// Αξιολογείται ως 3
{ val one = 1; val two = 2; one + two }
```

<div class="solution">
Στο επόμενο παράδειγμα φαίνεται ότι οι παράμετροι μεθόδων αξιολογούνται από αριστερά προς τα δεξιά.

```tut:book
Color.hsl(
  {
    println("a")
    0.degrees
  },
  {
    println("b")
    1.normalized
  },
  { 
    println("c")
    1.normalized
  }
)
```

Μπορούμε να το γράψουμε πιο συμπυκνωμένα όπως παρακάτω
```tut:book
Color.hsl({ println("a"); 0.degrees },
          { println("b"); 1.normalized },
          { println("c"); 1.normalized })
```
</div>


#### Η Τελευταία Σειρά  {-}

Με τι σειρά αξιολογούνται οι εκφράσεις στην Scala;
Κάντε ότι πειράματα χρειάζεστε ώστε να βρείτε μια απάντηση γι'αυτό το ερώτημα που να σας ικανοποιεί.
Μπορείτε  πολύ λογικά να υποθέσετε ότι η Scala χρησιμοποιεί συγκεκριμένους κανόνες για όλες τις εκφράσεις.
Δεν υπάρχουν ειδικές περιπτώσεις και διαφορετικές εκφράσεις.

<div class="solution">
Έχουμε ήδη δει ότι οι εκφράσεις αξιολογούνται από πάνω προς τα κάτω, και οι παράμετροι μεθόδων από τα αριστερά προς τα δεξιά.
Ισως να θέλουμε να ελεγξουμε ότι οι εκφράσεις γενικώς αξιολογούνται από τα αριστερά προς τα δεξιά.
Αυτό μπορούμε να το δείξουμε αρκετά εύκολα.

```tut:book
{ println("a"); 1 } + { println("b"); 2 } + { println("c"); 3}
```

Συνεπώς, ως συμπέρασμα μπορούμε να πούμε ότι οι εκφράσεις στην Scala αξιολογούνται από πάνω προς τα κάτω και από τα αριστερά προς τα δεξιά.
</div>

[^ειδικές-περιπτώσεις]: Αυτό δεν είναι ακριβώς η αλήθεια. Υπάρχουν μερικές ειδικές περιπτώσεις στις οποίες η σειρά αξιολόγησης έχει σημασία ακόμη και στις καθαρές εκφράσεις. Δεν θα ασχοληθούμε με αυτές τις περιπτώσεις εδώ. Εάν όμως θέλετε να μάθετε περισσότερα, αφού είναι ενδιαφέρονται και χρήσιμα θέματα, μπορείτε να διαβάσετε για την "eager evaluation" και την "lazy evaluation".
